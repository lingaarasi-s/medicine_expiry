<!DOCTYPE html>
<html>
<head>
    <title>Sales History</title>
</head>
<body>

<h2>üìä Sales History</h2>

<!-- ACTION BUTTONS -->
<button onclick="goDashboard()">üè† Dashboard</button>
<button onclick="newSale()">‚ûï New Sale</button>

<br><br>


<table border="1">
<tr>
    <th>Bill No</th>
    <th>Customer ID</th>
    <th>Medicine</th>
    <th>Batch</th>
    <th>Qty</th>
    <th>Total</th>
    <th>Date</th>
</tr>
<tbody id="list"></tbody>
</table>

<script>

function goDashboard() {
    window.location.href = "index.html";
}

function newSale() {
    window.location.href = "new-sale.html";
}

fetch("http://localhost:8080/api/billing/history")
.then(res => res.json())
.then(data => {

    const tbody = document.getElementById("list");

    // üîπ Group by billNo
    const grouped = {};
    data.forEach(sale => {
        if (!grouped[sale.billNo]) {
            grouped[sale.billNo] = [];
        }
        grouped[sale.billNo].push(sale);
    });

    // üîπ Build table with rowspan
    Object.keys(grouped).forEach(billNo => {
        const sales = grouped[billNo];
        const rowSpan = sales.length;

        sales.forEach((s, index) => {
            let row = "<tr>";

            // Show Bill No, Customer ID & Date only once
            if (index === 0) {
                row += `<td rowspan="${rowSpan}">${billNo}</td>`;
                row += `<td rowspan="${rowSpan}">${s.customerId}</td>`;
            }

            row += `
                <td>${s.medicineName}</td>
                <td>${s.batchNo}</td>
                <td>${s.quantity}</td>
                <td>‚Çπ${s.totalAmount}</td>
            `;

            if (index === 0) {
                row += `<td rowspan="${rowSpan}">${s.saleDate}</td>`;
            }

            row += "</tr>";
            tbody.innerHTML += row;
        });
    });
});
</script>


</body>
</html>
